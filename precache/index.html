<html>

<head>
	<link rel="manifest" href="mypwa.webmanifest">
	<script defer>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function () {
				navigator.serviceWorker.register('./service-worker.js').then(function (registration) {
					// Registration was successful
					console.log('ServiceWorker registration successful with scope: ', registration.scope);
				}, function (err) {
					// registration failed :(
					console.log('ServiceWorker registration failed: ', err);
				});
			});
		}


	</script>
	<script>
		function loadData() {
			console.log("Loaded");

			function status(response) {
				if (response.status >= 200 && response.status < 300) {
					return Promise.resolve(response)
				} else {
					return Promise.reject(new Error(response.statusText))
				}
			}

			function json(response) {
				return response.json()
			}

			fetch('https://opensky-network.org/api/states/all', { mode: 'cors' })
				.then(status)
				.then(json)
				.then(function (data) {
					console.log('Request succeeded with JSON response', data);
					document.getElementById("output").innerHTML = JSON.stringify(data);
					document.getElementById("time").innerHTML = data['time'];
				}).catch(function (error) {
					console.log('Request failed', error);
					document.getElementById("output").innerHTML = error;
				});

			fetch('./data1.json', { mode: 'cors' })
				.then(status)
				.then(json)
				.then(function (data) {
					console.log('data 1 Request succeeded with JSON response', data);
					document.getElementById("output").innerHTML = JSON.stringify(data);
					document.getElementById("time").innerHTML = data['time'];
				}).catch(function (error) {
					console.log('data 1 Request failed', error);
					document.getElementById("output").innerHTML = error;
				});

		}

	</script>
</head>

<body onload="loadData()">
	<h1>Demonstration of preloading files with service worker</h1>
	Flight Data as of <span id="time"></span><br />
	<span id="output"></span>
</body>

</html>